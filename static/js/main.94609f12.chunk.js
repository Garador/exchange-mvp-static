(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{44:function(e,t,a){e.exports=a(68)},49:function(e,t,a){},68:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(35),i=a.n(s);a(49),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=a(7),o=a(6),l=a(9),u=a(8),d=a(2),m=a.n(d),f=a(3),h=a(14),p={SIGN_UP:"/signup",SIGN_IN:"/signin",NEW_POST:"/newPost",VIEW_POST:"/post/:postId",EDIT_POST:"/edit/post/:postId",PROFILE:"/profile",PUBLIC_PROFILE:"/profile/:profileId",HOME:"/",ACCOUNT:"/account",PASSWORD_FORGET:"/pw-forget"},g=(r.a.createContext(null),a(25)),b=a.n(g),v=(a(51),a(52),a(54),a(36)),k={apiKey:"AIzaSyALX8Goj0Hgaxo200ixjfdqIMGwr52ZEZA",authDomain:"venpecambiosmvp.firebaseapp.com",databaseURL:"https://venpecambiosmvp.firebaseio.com",projectId:"venpecambiosmvp",storageBucket:"venpecambiosmvp.appspot.com",messagingSenderId:"998948186915",appId:"1:998948186915:web:c22b9b94701780290e3a96"},E=function(){function e(){Object(c.a)(this,e),this.auth=void 0,this.firestore=void 0,this.storage=void 0,b.a.initializeApp(k),this.auth=b.a.auth(),this.firestore=b.a.firestore(),this.storage=b.a.storage()}return Object(o.a)(e,[{key:"createUserWithEmailAndPassword",value:function(e,t){return this.auth.createUserWithEmailAndPassword(e,t)}},{key:"signInWithEmailAndPassword",value:function(e,t){return this.auth.signInWithEmailAndPassword(e,t)}},{key:"signOut",value:function(){this.auth.signOut()}},{key:"listenAuthChanges",value:function(e){this.auth.onAuthStateChanged(e)}},{key:"waitForAuth",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var a=t.auth.onAuthStateChanged((function(t){e(t),a()}))}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"firestoreTimestamp",get:function(){return v.firestore.FieldValue.serverTimestamp()}}],[{key:"instance",get:function(){return this._instance=this._instance?this._instance:new e,this._instance}}]),e}();E._instance=void 0;var y=E.instance,w=y,O=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={loading:!1},e}return Object(o.a)(a,[{key:"load",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.next=3,w.waitForAuth();case 3:this.loading=!1;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.load().then((function(){})).catch((function(){}))}},{key:"render",value:function(){return r.a.createElement("div",null,this.loading?r.a.createElement(r.a.Fragment,null):r.a.createElement("nav",{className:"uk-navbar-container","uk-navbar":"mode: click"},r.a.createElement("div",{className:"uk-navbar-left"},r.a.createElement("ul",{className:"uk-navbar-nav"},r.a.createElement("li",null,r.a.createElement(h.b,{to:p.HOME},"Inicio")),this.profile?r.a.createElement(r.a.Fragment,null,r.a.createElement("li",null,r.a.createElement(h.b,{to:p.NEW_POST},"Nueva Oferta")),r.a.createElement("li",null,r.a.createElement(h.b,{to:p.PROFILE},"Perfil"))):r.a.createElement(r.a.Fragment,null),r.a.createElement("li",null,r.a.createElement("a",{href:"#"},"Autorizaci\xf3n"),r.a.createElement("div",{className:"uk-navbar-dropdown"},r.a.createElement("ul",{className:"uk-nav uk-navbar-dropdown-nav"},this.profile?r.a.createElement("li",{style:{cursor:"pointer"},onClick:function(){return w.auth.signOut()}},r.a.createElement("a",null,"Salir")):r.a.createElement(r.a.Fragment,null,r.a.createElement("li",null,r.a.createElement(h.b,{to:p.SIGN_UP},"Crear Cuenta")),r.a.createElement("li",null,r.a.createElement(h.b,{to:p.SIGN_IN},"Log In"))))))))))}},{key:"username",get:function(){return w.auth.currentUser?w.auth.currentUser.displayName||w.auth.currentUser.email:"NOT LOGGED IN"}},{key:"profile",get:function(){return w.auth.currentUser}},{key:"loading",set:function(e){this.setState({loading:e})},get:function(){return this.state.loading}}]),a}(r.a.Component),x=a(11),I=a(5),N=a(22),j=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"hasValidOfferCreationPayload",value:function(e){return!(isNaN(e.accept_ammount)||e.accept_ammount<=0)&&(!(isNaN(e.offer_ammount)||e.accept_ammount<=0)&&(!!(e.accept_currency&&e.description&&e.offer_currency&&e.offer_payment_method&&e.title)&&!(e.description.length>300||e.title.length>30)))}},{key:"hasValidBidData",value:function(e){return!!e.poster&&!!e.offer}},{key:"hasValidContactUData",value:function(e){return(!e.email||!(e.email.length>30||e.email.length<5))&&((!e.whatsapp||!(e.whatsapp.length>10||e.whatsapp.length<5))&&(!e.phone||!(e.phone.length>10||e.phone.length<5)))}}],[{key:"Instance",get:function(){return this._instance=this._instance?this._instance:new e,this._instance}}]),e}();j._instance=void 0;var C,A,S=j.Instance;!function(e){e[e.ACTIVE=1]="ACTIVE",e[e.TAKEN=2]="TAKEN",e[e.CLOSED=3]="CLOSED"}(C||(C={})),function(e){e[e.ACTIVE=1]="ACTIVE",e[e.ACCEPTED=2]="ACCEPTED",e[e.REJECTED=3]="REJECTED",e[e.CANCELLED=4]="CANCELLED"}(A||(A={}));var B=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"createOffer",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(j.Instance.hasValidOfferCreationPayload(t)){e.next=2;break}throw new Error("Invalid data");case 2:if(y.auth.currentUser){e.next=4;break}throw new Error("In order to create an offer, the user must be logged-in");case 4:return t.poster=y.auth.currentUser.uid,t.status=C.ACTIVE,t.createdAt=y.firestoreTimestamp,a=y.firestore.collection("offers").doc().id,e.next=10,y.firestore.collection("offers").doc(a).set(t);case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateOffer",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=JSON.parse(JSON.stringify(t)),j.Instance.hasValidOfferCreationPayload(t)){e.next=3;break}throw new Error("Invalid data");case 3:if(y.auth.currentUser){e.next=5;break}throw new Error("In order to create an offer, the user must be logged-in");case 5:return t.poster=y.auth.currentUser.uid,t.images&&delete t.images,t.status&&delete t.status,t.createdAt&&delete t.createdAt,e.next=11,y.firestore.collection("offers").doc(a).update(t);case 11:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchOffer",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.firestore.collection("offers").doc(t).get();case 2:if(n=e.sent,!(r=n.exists?n.data():null)||a){e.next=8;break}return e.next=7,this.getImages(t);case 7:r.images=e.sent;case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"fetchOffers",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a,n,r){var s,i,c,o,l,u;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(s=y.firestore.collection("offers").where("status","==",C.ACTIVE)).orderBy("createdAt","desc"),a?(s=s.startAfter(a),r&&(s=s.limit(r))):n?(s=s.endBefore(n),r&&(s=s.limitToLast(r))):r&&(s=s.limit(r)),e.next=5,s.get();case 5:i=e.sent,c=[],o=0;case 8:if(!(o<i.docs.length)){e.next=21;break}if(l=i.docs[o],(u=l.data()).createdAt=u.createdAt?u.createdAt.toDate():null,u.id=l.id,!t){e.next=17;break}return e.next=16,this.getImages(u.id);case 16:u.images=e.sent;case 17:c.push(u);case 18:o++,e.next=8;break;case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"getImages",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.firestore.collection("offers/".concat(t,"/image")).get();case 2:return a=e.sent,n=[],a.docs.forEach((function(e){var t=e.data();t.id=e.id,n.push(t)})),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeImage",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&a){e.next=2;break}throw new Error("Offer and Image ID's must be defined");case 2:return e.next=4,y.storage.ref(a.ref).delete();case 4:return e.next=6,y.firestore.doc("offers/".concat(t,"/image/").concat(a.id)).delete();case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"uploadImage",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a){var n,r,s,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.name.split(".").pop(),!(["jpg","png"].indexOf(n||"")<0)){e.next=4;break}throw new Error("Invalid file image");case 4:return r=y.firestore.collection("offers/".concat(t,"/image")).doc(),s="offers/".concat(t,"/image/").concat(r.id,".").concat(n),e.next=8,y.storage.ref(s).put(a);case 8:return i=e.sent,e.next=11,i.ref.getDownloadURL();case 11:return c=e.sent,e.next=14,r.set({downloadURL:c,bytes:i.totalBytes,ref:s});case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"_updateOfferStatus",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.firestore.collection("offers").doc(t).update({status:a});case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"closeOffer",value:function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchOffer(t,!0);case 2:if(e.sent.status!==C.ACTIVE){e.next=8;break}return e.next=6,this._updateOfferStatus(t,C.CLOSED);case 6:e.next=9;break;case 8:throw new Error("Only active-status offers can be updated");case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOffer",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.firestore.collection("offers").doc(t).get();case 2:return a=e.sent,e.abrupt("return",Object(N.a)(Object(N.a)({},a.data()),{},{id:a.id}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOfferStatus",value:function(e){if(!e)return"";switch(e){case C.ACTIVE:return"ACTIVE";case C.CLOSED:return"CLOSED";case C.TAKEN:return"TAKEN";default:return"UNKNOWN (".concat(e,")")}}},{key:"testAssumption",value:function(){console.log(y.firestore.fieldValue)}}],[{key:"Instance",get:function(){return this._instance=this._instance?this._instance:new e,this._instance}}]),e}();B._instance=void 0;var _=B.Instance,P=a(38),V=a.n(P),D=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"getDate",value:function(e){return e?e.toLocaleString():null}},{key:"getCurrency",value:function(e){return V()(e).format("0,0")}}],[{key:"Instance",get:function(){return this._instance=this._instance?this._instance:new e,this._instance}}]),e}();D._instance=void 0;var L=D.Instance,T=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={offers:[],offersPaging:{startAfter:null,stopBefore:null,limit:5,page:0}},n.loadOffers=n.loadOffers.bind(Object(I.a)(n)),n.pageBack=n.pageBack.bind(Object(I.a)(n)),n.pageForth=n.pageForth.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"loadOffers",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,a,n,r,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.state.offersPaging,a=t.startAfter,n=t.stopBefore,r=t.limit,console.log({startAfter:null===a||void 0===a?void 0:a.createdAt,stopBefore:null===n||void 0===n?void 0:n.createdAt,limit:r,page:this.state.offersPaging.page}),e.next=5,_.fetchOffers(!1,null===a||void 0===a?void 0:a.createdAt,null===n||void 0===n?void 0:n.createdAt,r);case 5:s=e.sent,this.setState((function(e){return e.offers=s,e.offersPaging.startAfter=s[0],e.offersPaging.stopBefore=s[s.length-1],e})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log({e:e.t0}),console.log("Error loading offers...");case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.loadOffers()}},{key:"pageBack",value:function(){var e=this;this.state.offersPaging.page>0&&this.setState((function(e){return e.offersPaging.stopBefore=e.offersPaging.startAfter,e.offersPaging.startAfter=null,e.offersPaging.page-=1,e}),(function(){e.loadOffers()}))}},{key:"pageForth",value:function(){var e=this;this.state.offers.length>=this.state.offersPaging.limit&&this.setState((function(e){return e.offersPaging.startAfter=e.offersPaging.stopBefore,e.offersPaging.stopBefore=null,e.offersPaging.page+=1,e}),(function(){e.loadOffers()}))}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h3",null,"Inicio"),r.a.createElement("table",{className:"uk-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Fecha"),r.a.createElement("th",null,"Ofrece"),r.a.createElement("th",null,"Ofrece Pago"),r.a.createElement("th",null,"Acepta"),r.a.createElement("th",null,"Acepta Pago"),r.a.createElement("th",null,"Acciones"))),r.a.createElement("tbody",null,this.state.offers.map((function(e){return r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,L.getDate(e.createdAt)),r.a.createElement("td",null,L.getCurrency(e.offer_ammount),e.offer_currency),r.a.createElement("td",null,e.offer_payment_method),r.a.createElement("td",null,L.getCurrency(e.accept_ammount),e.accept_currency),r.a.createElement("td",null,e.accept_payment_method),r.a.createElement("td",null,r.a.createElement(h.b,{to:p.VIEW_POST.replace(":postId",e.id+"")},r.a.createElement("button",{className:"uk-button uk-button-default"},"Info")),r.a.createElement(h.b,{to:p.PUBLIC_PROFILE.replace(":profileId",e.poster+"")},r.a.createElement("button",{className:"uk-button uk-button-default"},"Poster"))))}))),r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("td",{colSpan:3,style:{textAlign:"left"}},r.a.createElement("button",{className:"uk-button",onClick:this.pageBack},"Atr\xe1s")),r.a.createElement("td",{colSpan:2,style:{textAlign:"right"}},r.a.createElement("button",{className:"uk-button",onClick:this.pageForth},"Siguiente"))))))}}]),a}(r.a.Component),U=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={formValue:{},redirectHome:!1},n.setValue=n.setValue.bind(Object(I.a)(n)),n.submit=n.submit.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"setValue",value:function(e){var t=e.currentTarget.getAttribute("custom-id"),a=e.currentTarget.value;this.setState((function(e){return e.formValue[t]=a,e}))}},{key:"submit",value:function(e){var t=this;e.preventDefault(),_.createOffer(this.state.formValue).then((function(e){console.log("Created offer ID:",e),window.alert("Se ha creado su oferta de manera satisfactoria!"),t.setState({redirectHome:!0})})).catch((function(e){console.log("Error creating offer: ",e)}))}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return this.state.redirectHome?r.a.createElement(x.a,{to:"/"}):r.a.createElement("div",null,r.a.createElement("form",{style:{padding:"2em"},onSubmit:this.submit},r.a.createElement("h3",null,"Nueva Oferta"),r.a.createElement("fieldset",{className:"uk-fieldset"},r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"T\xedtulo"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"title",className:"uk-input",type:"text",placeholder:"Title"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Descripci\xf3n de La Oferta"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("textarea",{onChange:this.setValue,"custom-id":"description",className:"uk-textarea",maxLength:300}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Moneda de Oferta"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{className:"uk-select",id:"form-stacked-select",onChange:this.setValue,"custom-id":"offer_currency"},r.a.createElement("option",null,"Selecciona tu Moneda"),r.a.createElement("option",{value:"USD"},"USD"),r.a.createElement("option",{value:"BSF"},"BSF")))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Cantidad de Oferta"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"offer_ammount",type:"number",className:"uk-input"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"M\xe9todo de Pago Aceptado"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{onChange:this.setValue,"custom-id":"offer_payment_method",className:"uk-select",id:"form-stacked-select"},r.a.createElement("option",null,"Selecciona el M\xe9todo de Pago para tu oferta"),r.a.createElement("option",{value:"transferencia"},"Transferencia"),r.a.createElement("option",{value:"efectivo"},"Efectivo")))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Moneda Aceptada como Pago"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{onChange:this.setValue,"custom-id":"accept_currency",className:"uk-select",id:"form-stacked-select"},r.a.createElement("option",null,"Selecciona tu Moneda"),r.a.createElement("option",{value:"USD"},"USD"),r.a.createElement("option",{value:"BSF"},"BSF")))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Cantidad de Moneda Aceptada"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"accept_ammount",type:"number",className:"uk-input"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"M\xe9todo de Pago Aceptado"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{onChange:this.setValue,"custom-id":"accept_payment_method",className:"uk-select",id:"form-stacked-select"},r.a.createElement("option",null,"Selecciona tu M\xe9todo de Pago Aceptado"),r.a.createElement("option",{value:"transferencia"},"Transferencia"),r.a.createElement("option",{value:"efectivo"},"Efectivo")))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("legend",{className:"uk-legend",style:{fontSize:"1.2em"}},"Tasa de Cambio: ",r.a.createElement("b",null,this.exchangeRate))),r.a.createElement("button",{className:"uk-button uk-button-primary",role:"submit"},"Crear Nueva Oferta"))))}},{key:"exchangeRate",get:function(){return(this.state.formValue.offer_ammount||1)/(this.state.formValue.accept_ammount||1)}}]),a}(r.a.Component),R=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={formValue:{},redirect:!1},n.setValue=n.setValue.bind(Object(I.a)(n)),n.submit=n.submit.bind(Object(I.a)(n)),n.load=n.load.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"setValue",value:function(e){var t=e.currentTarget.getAttribute("custom-id"),a=e.currentTarget.value;this.setState((function(e){return e.formValue[t]=a,e}))}},{key:"submit",value:function(e){var t=this;e.preventDefault(),this.state.formValue.password===this.state.formValue.password&&y.createUserWithEmailAndPassword(this.state.formValue.email,this.state.formValue.password).then((function(e){window.alert("Su cuenta ha sido creada satisfactoriamente."),t.setState({redirect:!0})})).catch((function(e){window.alert("Hubo un error creando tu cuenta. Por favor, verifique sus datos e intente nuevamente.")}))}},{key:"load",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.waitForAuth();case 2:y.auth.currentUser&&this.setState({redirect:!0});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.load()}},{key:"render",value:function(){return this.state.redirect?r.a.createElement(x.a,{to:"/"}):r.a.createElement("div",null,r.a.createElement("form",{style:{padding:"2em"},onSubmit:this.submit},r.a.createElement("h3",null,"Registrarte"),r.a.createElement("fieldset",{className:"uk-fieldset"},r.a.createElement("legend",{className:"uk-legend",style:{fontSize:"1.2em"}},"Email"),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"email",className:"uk-input",type:"email",placeholder:"Email"})),r.a.createElement("legend",{className:"uk-legend",style:{fontSize:"1.2em"}},"Contrase\xf1a"),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"password",className:"uk-input",type:"password",placeholder:"Password"})),r.a.createElement("legend",{className:"uk-legend",style:{fontSize:"1.2em"}},"Repetir Contrase\xf1a"),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"repeat-password",className:"uk-input",type:"password",placeholder:"Confirm"})),r.a.createElement("button",{className:"uk-button uk-button-primary",role:"submit"},"Crear Cuenta"))))}}]),a}(r.a.Component),F=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={formValue:{}},n.setValue=n.setValue.bind(Object(I.a)(n)),n.submit=n.submit.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"setValue",value:function(e){var t=e.currentTarget.getAttribute("custom-id"),a=e.currentTarget.value;this.setState((function(e){return e.formValue[t]=a,e}))}},{key:"submit",value:function(e){e.preventDefault(),y.signInWithEmailAndPassword(this.state.formValue.email,this.state.formValue.password).then((function(e){console.log("Data")})).catch((function(e){window.alert("Error")}))}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("form",{style:{padding:"2em"},onSubmit:this.submit},r.a.createElement("h3",null,"Sign In"),r.a.createElement("fieldset",{className:"uk-fieldset"},r.a.createElement("legend",{className:"uk-legend",style:{fontSize:"1.2em"}},"Email"),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"email",className:"uk-input",type:"email",placeholder:"Email"})),r.a.createElement("legend",{className:"uk-legend",style:{fontSize:"1.2em"}},"Password"),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"password",className:"uk-input",type:"password",placeholder:"Password"})),r.a.createElement("button",{className:"uk-button uk-button-primary",role:"submit"},"Sign In"))))}}]),a}(r.a.Component),M=a(39),z=a(43),G=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"createBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=y.firestore.collection("bid").doc().id,y.auth.currentUser){e.next=3;break}throw new Error("User must be logged in to enable this action");case 3:if(t.poster=y.auth.currentUser.uid,S.hasValidBidData(t)){e.next=6;break}throw new Error("Invalid bid data");case 6:return e.next=8,y.firestore.collection("bid").where("poster","==",t.poster).where("offer","==",t.offer).get();case 8:if(!(e.sent.size>0)){e.next=11;break}throw new Error("Can't bid two times on the same offer");case 11:return t.status=A.ACTIVE,t.createdAt=y.firestoreTimestamp,e.next=15,y.firestore.collection("bid").doc(a).set(t);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.auth.currentUser){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,this.getBids(t);case 4:return a=e.sent,e.abrupt("return",a.size>0);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBidContact",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.firestore.collection("contact").doc(t).get();case 2:return a=e.sent,e.abrupt("return",a.data());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.firestore.collection("bid").doc(t).get();case 2:return a=e.sent,n=Object(N.a)(Object(N.a)({},a.data()),{},{id:a.id}),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBids",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.auth.currentUser){e.next=2;break}throw new Error("No puedes obtener tus pujas si no has accedido a tu cuenta");case 2:return e.next=4,y.firestore.collection("bid").where("poster","==",y.auth.currentUser.uid).where("offer","==",t).get();case 4:return a=e.sent,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGeneralBids",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.firestore.collection("bid").where("offer","==",t).get();case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchGeneralBids",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a,n,r){var s,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(s=y.firestore.collection("bid").where("offer","==",t)).orderBy("createdAt","asc"),a?(s=s.startAfter(a),r&&(s=s.limit(r))):n?(s=s.endBefore(n),r&&(s=s.limitToLast(r))):r&&(s=s.limit(r)),e.next=5,s.get();case 5:return i=e.sent,c=[],i.docs.forEach((function(e){var t=e.data();t.createdAt=t.createdAt.toDate(),t.id=e.id,c.push(t)})),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"hasGeneralBids",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.firestore.collection("bid").where("offer","==",t).limit(1).get();case 2:return a=e.sent,e.abrupt("return",!a.empty);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"cancelBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a,n,r,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getBids(t);case 2:if(!((a=e.sent).size>0)){e.next=26;break}n=Object(z.a)(a.docs),e.prev=5,n.s();case 7:if((r=n.n()).done){e.next=18;break}return s=r.value,e.prev=9,e.next=12,s.ref.update({status:A.CANCELLED});case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(9);case 16:e.next=7;break;case 18:e.next=23;break;case 20:e.prev=20,e.t1=e.catch(5),n.e(e.t1);case 23:return e.prev=23,n.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[5,20,23,26],[9,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"acceptBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.firestore.doc("bid/".concat(t)).update({status:A.ACCEPTED});case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new Error("Error aceptado la puja");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"rejectBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.firestore.doc("bid/".concat(t)).update({status:A.REJECTED});case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new Error("Error rechazando la puja");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()}],[{key:"Instance",get:function(){return this._instance=this._instance?this._instance:new e,this._instance}}]),e}();G._instance=void 0;var W=G.Instance,H=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,null,[{key:"Instance",get:function(){return this._instance=this._instance?this._instance:new e,this._instance}}]),Object(o.a)(e,[{key:"showModal",value:function(e,t){UIkit.modal(document.getElementById(e)).show(t||{})}},{key:"hideModal",value:function(e,t){UIkit.modal(document.getElementById(e)).hide(t||{})}}]),e}();H._instance=void 0;var J=H.Instance,K=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"rateBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a,n){var r,s,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.auth.currentUser){e.next=2;break}throw new Error("User must be logged in to rate");case 2:if(t&&a&&n){e.next=4;break}throw new Error("Invalid data for offer");case 4:return e.next=6,W.getBid(n);case 6:return s=e.sent,i={comment:t,rate:parseInt(a),bidId:n,poster:null===(r=w.auth.currentUser)||void 0===r?void 0:r.uid,ratedUser:s.poster+"",createdAt:w.firestoreTimestamp,offerId:null},e.next=10,this.hasRateOnBid(n);case 10:if(!e.sent){e.next=13;break}throw new Error("Can't add more than one review for a bid.");case 13:return e.next=15,w.firestore.collection("rating").add(i);case 15:return c=e.sent,e.abrupt("return",c.id);case 17:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"rateOffer",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a,n){var r,s,i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.auth.currentUser){e.next=2;break}throw new Error("User must be logged in to rate");case 2:if(t&&a&&n){e.next=4;break}throw new Error("Invalid data for offer");case 4:return e.next=6,_.getOffer(n);case 6:return s=e.sent,i={comment:t,rate:parseInt(a),offerId:n,poster:null===(r=w.auth.currentUser)||void 0===r?void 0:r.uid,ratedUser:s.poster+"",createdAt:w.firestoreTimestamp,bidId:null},e.next=10,this.hasRateOnOffer(n);case 10:if(!e.sent){e.next=13;break}throw new Error("Can't add more than one review for an offer.");case 13:return e.next=15,w.firestore.collection("rating").add(i);case 15:return c=e.sent,e.abrupt("return",c.id);case 17:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"hasRateOnOffer",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.auth.currentUser){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,w.firestore.collection("rating").where("poster","==",w.auth.currentUser.uid).where("offerId","==",t).limit(1).get();case 4:return a=e.sent,e.abrupt("return",!a.empty);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchOfferRatings",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a,n,r,s){var i,c,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(i=w.firestore.collection("rating").where("offerId","==",t)).orderBy("createdAt","asc"),a?(i=i.startAfter(a),r&&(i=i.limit(r))):n?(i=i.endBefore(n),r&&(i=i.limitToLast(r))):r&&(i=i.limit(r)),e.next=5,i.get();case 5:return c=e.sent,o=c.docs.map((function(e){var t=e.data();return t.createdAt=t.createdAt.toDate(),t.id=e.id,t})),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()},{key:"fetchUserRatings",value:function(){var e=Object(f.a)(m.a.mark((function e(t,a,n,r,s){var i,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=w.firestore.collection("rating").where("ratedUser","==",t),"offer"===a?i=i.where("bidId","==",null):"bid"===a&&(i=i.where("offerId","==",null)),i=i.orderBy("createdAt","asc"),n?(i=i.startAfter(n),s&&(i=i.limit(s))):r?(i=i.endBefore(r),s&&(i=i.limitToLast(s))):s&&(i=i.limit(s)),e.next=6,i.get();case 6:return c=e.sent,e.abrupt("return",c.docs.map((function(e){var t=e.data();return t.createdAt=t.createdAt.toDate(),t.id=e.id,t})));case 8:case"end":return e.stop()}}),e)})));return function(t,a,n,r,s){return e.apply(this,arguments)}}()},{key:"hasRateOnBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.auth.currentUser){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,w.firestore.collection("rating").where("poster","==",w.auth.currentUser.uid).where("bidId","==",t).limit(1).get();case 4:return a=e.sent,e.abrupt("return",!a.empty);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"Instance",get:function(){return this._instance=this._instance?this._instance:new e,this._instance}}]),e}();K._instance=void 0;var Z=K.Instance,q=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={formValue:{rate:"0",comment:""},loading:{saving:!1}},n.load=n.load.bind(Object(I.a)(n)),n.save=n.save.bind(Object(I.a)(n)),n.setInput=n.setInput.bind(Object(I.a)(n)),n.setLoading=n.setLoading.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"load",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this.listenUIKit((function(){var e=window;try{e.UIkit.modal(document.getElementById(t.props.modalId)).hide()}catch(a){console.log({e:a})}}))}catch(a){console.log({e:a}),console.log("Error setting modal...")}case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setLoading",value:function(e,t){this.setState((function(a){return a.loading[e]=t,a}))}},{key:"listenUIKit",value:function(e){var t=setInterval((function(){window.UIkit&&(clearInterval(t),e())}),50)}},{key:"componentDidMount",value:function(){this.load()}},{key:"save",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setLoading("saving",!0),e.prev=1,!this.props.offerId){e.next=10;break}return console.log("Rating offer"),e.next=6,Z.rateOffer(this.state.formValue.comment,this.state.formValue.rate,this.props.offerId);case 6:window.alert("Offer rated properly"),J.hideModal(this.props.modalId),e.next=20;break;case 10:if(!this.props.bidId){e.next=18;break}return console.log("Rating bid"),e.next=14,Z.rateBid(this.state.formValue.comment,this.state.formValue.rate,this.props.bidId);case 14:window.alert("Bid rated properly"),J.hideModal(this.props.modalId),e.next=20;break;case 18:console.log("Nothing to rate..."),console.log(this.props);case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(1),console.log({e:e.t0}),window.alert("Error rating");case 26:this.setLoading("saving",!1);case 27:case"end":return e.stop()}}),e,this,[[1,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"hide",value:function(){}},{key:"setInput",value:function(e){var t=e.currentTarget,a=t.value,n=t.id;this.setState((function(e){return e.formValue[n]=a,e}))}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{id:this.props.modalId},r.a.createElement("div",{className:"uk-modal-dialog uk-modal-body"},r.a.createElement("h2",{className:"uk-modal-title"},"Review your experience"),r.a.createElement("fieldset",{className:"uk-fieldset"},r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Your Rating"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{onChange:this.setInput,className:"uk-select",id:"rate"},r.a.createElement("option",{value:"0"},"0/5"),r.a.createElement("option",{value:"20"},"1/5"),r.a.createElement("option",{value:"40"},"2/5"),r.a.createElement("option",{value:"60"},"3/5"),r.a.createElement("option",{value:"80"},"4/5"),r.a.createElement("option",{value:"100"},"5/5")))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Your Comment"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("textarea",{onChange:this.setInput,id:"comment",className:"uk-textarea"})))),r.a.createElement("button",{disabled:this.isLoading,className:"uk-button uk-button-default",type:"button",onClick:this.save},"Save"),r.a.createElement("button",{disabled:this.isLoading,className:"uk-button uk-button-default uk-modal-close",type:"button"},"Close"))))}},{key:"isLoading",get:function(){for(var e=0,t=Object.keys(this.state.loading);e<t.length;e++){var a=t[e];if(this.state.loading[a])return!0}return!1}}]),a}(r.a.Component),Y=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={bids:[],loading:!0,displayBid:{},displayBidContact:{},post:null,editingBidRate:"",bidPaging:{startAfter:null,stopBefore:null,limit:5,page:0}},n.load=n.load.bind(Object(I.a)(n)),n.setLoading=n.setLoading.bind(Object(I.a)(n)),n.rejectBid=n.rejectBid.bind(Object(I.a)(n)),n.loadBids=n.loadBids.bind(Object(I.a)(n)),n.loadPost=n.loadPost.bind(Object(I.a)(n)),n.prevBids=n.prevBids.bind(Object(I.a)(n)),n.nextBids=n.nextBids.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"setLoading",value:function(e){this.setState({loading:e})}},{key:"acceptBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading(!0),e.prev=1,e.next=4,W.acceptBid(t);case 4:return e.next=6,this.load();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),window.alert("Bid couldn't be accepted");case 11:this.setLoading(!1);case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"loadBids",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,a,n,r,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.bidPaging,a=t.startAfter,n=t.stopBefore,r=t.limit,this.setLoading(!0),console.log({startAfter:a,stopBefore:n,limit:r}),e.next=5,W.fetchGeneralBids(this.postId,null===a||void 0===a?void 0:a.createdAt,null===n||void 0===n?void 0:n.createdAt,r);case 5:s=e.sent,this.setState((function(e){return e.bids=s,e.bidPaging.startAfter=s[0],e.bidPaging.stopBefore=s[s.length-1],e})),this.setLoading(!1),this.setState({bids:s});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadPost",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_.fetchOffer(this.postId,!0);case 2:t=e.sent,this.setState({post:t});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setLoading(!0),e.next=4,Promise.all([this.loadBids(),this.loadPost()]);case 4:this.setLoading(!1),e.next=12;break;case 7:e.prev=7,e.t0=e.catch(0),console.log({e:e.t0}),this.setLoading(!1),console.log("Error loading bids...");case 12:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.load().catch((function(e){console.log("Error loading bids")})),document.getElementById("modal-details").setAttribute("uk-modal","")}},{key:"viewBidDetails",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading(!0),J.showModal("modal-details"),a=this.state.bids.find((function(e){return e.id===t})),e.next=5,W.getBidContact(a.poster);case 5:n=e.sent,this.setState({displayBid:a,displayBidContact:n}),this.setLoading(!1);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getStatus",value:function(e){switch(e.status){case A.ACTIVE:return"ACTIVA";case A.ACCEPTED:return"ACEPTADA";case A.CANCELLED:return"CANCELADA";case A.REJECTED:return"RECHAZADA";default:return e.status}}},{key:"rejectBid",value:function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading(!0),e.prev=1,e.next=4,W.rejectBid(t);case 4:return e.next=6,this.load();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),window.alert("Error rejecting bid");case 11:this.setLoading(!1);case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"rateBid",value:function(e){this.setState({editingBidRate:e}),J.showModal("rateSnippet")}},{key:"prevBids",value:function(){var e=this;this.state.bidPaging.page>0&&(this.setLoading(!0),this.setState((function(e){return e.bidPaging.stopBefore=e.bidPaging.startAfter,e.bidPaging.startAfter=null,e.bidPaging.page-=1,e}),(function(){e.setLoading(!1),e.loadBids()})))}},{key:"nextBids",value:function(){var e=this;this.state.bids.length>=this.state.bidPaging.limit&&(this.setLoading(!0),this.setState((function(e){return e.bidPaging.startAfter=e.bidPaging.stopBefore,e.bidPaging.stopBefore=null,e.bidPaging.page+=1,e}),(function(){e.setLoading(!1),e.loadBids()})))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("h3",null,"Pujas"),r.a.createElement("table",{className:"uk-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"ID de Puja"),r.a.createElement("th",null,"Acciones de Puja"))),r.a.createElement("tbody",null,this.state.bids.map((function(t){return r.a.createElement("tr",{className:"\n                                ".concat(t.status===A.ACCEPTED?"accepted ":"","\n                                ").concat(t.status===A.REJECTED?"rejected ":"","\n                                "),key:t.id},r.a.createElement("td",null,t.id),r.a.createElement("td",null,r.a.createElement("button",{className:"uk-button",disabled:e.state.loading,onClick:function(a){return e.viewBidDetails(t.id||"")}},"Details"),e.state.post&&e.state.post.status===C.ACTIVE?t.status===A.ACTIVE?r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"uk-button",disabled:e.state.loading,onClick:function(){return e.acceptBid(t.id||"")}},"Accept"),r.a.createElement("button",{className:"uk-button",disabled:e.state.loading,onClick:function(){return e.rejectBid(t.id||"")}},"Reject")):r.a.createElement(r.a.Fragment,null,t.status===A.ACCEPTED?r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"uk-button",disabled:e.state.loading,onClick:function(){return e.rateBid(t.id||"")}},"Rate Bid")):r.a.createElement(r.a.Fragment,null)):r.a.createElement(r.a.Fragment,null)))}))),r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("button",{className:"uk-button",disabled:this.state.loading,onClick:this.prevBids},"P\xe1gina Anterior")),r.a.createElement("td",{style:{textAlign:"right"}},r.a.createElement("button",{disabled:this.state.loading,className:"uk-button",onClick:this.nextBids},"Pr\xf3xima P\xe1gina"))))),r.a.createElement("div",{id:"modal-details"},r.a.createElement("div",{className:"uk-modal-dialog uk-modal-body"},r.a.createElement("h2",{className:"uk-modal-title"},"Bid ID: ",this.bid.id),r.a.createElement("h3",null,"STATUS ",r.a.createElement("b",null,this.getStatus(this.state.displayBid))),r.a.createElement("h3",null,"Contact"),r.a.createElement("b",null,"Whatsapp")," ",this.state.displayBidContact.whatsapp,r.a.createElement("hr",null),r.a.createElement("b",null,"Phone")," ",this.state.displayBidContact.phone,r.a.createElement("hr",null),r.a.createElement("b",null,"Email")," ",this.state.displayBidContact.email,r.a.createElement("hr",null),r.a.createElement("button",{className:"uk-button uk-button-default uk-modal-close",type:"button"},"Close"))),r.a.createElement(q,{modalId:"rateSnippet",bidId:this.state.editingBidRate}))}},{key:"bid",get:function(){return this.state.displayBid}},{key:"postId",get:function(){return this.props.match?this.props.match.params.postId:""}}]),a}(r.a.Component),X=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={ratings:[],loading:!1,paging:{startAfter:null,stopBefore:null,limit:5,page:0}},n.load=n.load.bind(Object(I.a)(n)),n.setLoading=n.setLoading.bind(Object(I.a)(n)),n.loadRatings=n.loadRatings.bind(Object(I.a)(n)),n.nextPage=n.nextPage.bind(Object(I.a)(n)),n.prevPage=n.prevPage.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"setLoading",value:function(e){this.setState({loading:e})}},{key:"load",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.waitForAuth();case 2:try{this.loadRatings()}catch(t){console.log({e:t}),window.alert("Error loading ratings!")}case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadRatings",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setLoading(!0),e.prev=1,t=[],!this.bidId){e.next=7;break}console.log("Loading bid ID"),e.next=17;break;case 7:if(!this.postId){e.next=13;break}return e.next=10,Z.fetchOfferRatings(this.postId||"",null===(a=this.state.paging.startAfter)||void 0===a?void 0:a.createdAt,null===(n=this.state.paging.stopBefore)||void 0===n?void 0:n.createdAt,this.state.paging.limit);case 10:t=e.sent,e.next=17;break;case 13:if(!this.ratedUser){e.next=17;break}return e.next=16,Z.fetchUserRatings(this.ratedUser,this.ratingType,this.state.paging.startAfter,this.state.paging.stopBefore,this.state.paging.limit);case 16:t=e.sent;case 17:this.setState((function(e){return e.ratings=t,e.paging.startAfter=t[0],e.paging.stopBefore=t[t.length-1],e})),e.next=24;break;case 20:e.prev=20,e.t0=e.catch(1),console.log({e:e.t0}),window.alert("Error loading the ratings!");case 24:this.setLoading(!1);case 25:case"end":return e.stop()}}),e,this,[[1,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.load()}},{key:"getRating",value:function(e){return parseInt(e.rate+"")/20+"/5"}},{key:"prevPage",value:function(){var e=this;this.state.paging.page>0&&(this.setLoading(!0),this.setState((function(e){return e.paging.stopBefore=e.paging.startAfter,e.paging.startAfter=null,e.paging.page-=1,e}),(function(){e.setLoading(!1),e.loadRatings()})))}},{key:"nextPage",value:function(){var e=this;this.state.ratings.length>=this.state.paging.limit&&(this.setLoading(!0),this.setState((function(e){return e.paging.startAfter=e.paging.stopBefore,e.paging.stopBefore=null,e.paging.page+=1,e}),(function(){e.setLoading(!1),e.loadRatings()})))}},{key:"getDate",value:function(e){return e.createdAt+""}},{key:"getData",value:function(){var e=this,t=this.state.ratings;if(t&&t.length)return t.map((function(t){return r.a.createElement("div",{className:"uk-card uk-card-body",key:t.id,style:{border:"1px solid grey",borderRadius:"10px",margin:"0.5em"}},r.a.createElement("b",null,e.getRating(t))," ",r.a.createElement("small",null,e.getDate(t)),r.a.createElement("br",null),t.comment)}))}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("table",{className:"uk-table"},r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{colSpan:2},r.a.createElement("h3",null,"Ratings"),this.getData()))),r.a.createElement("tfoot",null,r.a.createElement("tr",null,r.a.createElement("td",null,r.a.createElement("button",{className:"uk-button",disabled:this.state.loading,onClick:this.prevPage},"Anterior P\xe1gina")),r.a.createElement("td",{style:{textAlign:"right"}},r.a.createElement("button",{className:"uk-button",disabled:this.state.loading,onClick:this.nextPage},"Pr\xf3xima P\xe1gina"))))))}},{key:"postId",get:function(){return this.props.match.params.postId}},{key:"bidId",get:function(){return this.props.match.params.bidId}},{key:"posterId",get:function(){return this.props.match.params.posterId}},{key:"ratedUser",get:function(){return this.props.match.params.ratedUser}},{key:"ratingType",get:function(){return this.props.match.params.ratingType||"offer"}}]),a}(r.a.Component),$=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={formValue:{},b64Image:"",hasBids:!1},n.setValue=n.setValue.bind(Object(I.a)(n)),n.submit=n.submit.bind(Object(I.a)(n)),n.uploadNewImage=n.uploadNewImage.bind(Object(I.a)(n)),n.load=n.load.bind(Object(I.a)(n)),n.closeOffer=n.closeOffer.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"setValue",value:function(e){var t=e.currentTarget.getAttribute("custom-id"),a=e.currentTarget.value;this.setState((function(e){return e.formValue[t]=a,e}))}},{key:"submit",value:function(e){e.preventDefault(),_.updateOffer(this.state.formValue,this.postId).then((function(e){window.alert("Se ha guardado su oferta satisfactoriamente")})).catch((function(e){window.alert("Error actualizando la oferta")}))}},{key:"loadPost",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.loadingPost){e.next=2;break}return e.abrupt("return");case 2:return this.setState({loadingPost:!0}),e.prev=3,e.next=6,_.fetchOffer(this.postId);case 6:if(t=e.sent){e.next=9;break}throw new Error("Offer not found");case 9:return e.next=11,W.hasGeneralBids(this.postId);case 11:a=e.sent,this.setState((function(e){return e.formValue=t,e.hasBids=a,e})),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),window.alert("Error fetching offer");case 18:this.setState({loadingPost:!1});case 19:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"newImageInput",value:function(){var e;null===(e=document.getElementById("newImageInput"))||void 0===e||e.click()}},{key:"load",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.postId){e.next=3;break}return e.next=3,this.loadPost();case 3:document.getElementById("newImageInput").onchange=function(e){var a=e.target;if(a.files&&a.files[0]){var n=new FileReader;n.onload=function(e){console.log("Did read the image as b64"),t.setState({b64Image:e.target.result,newImageFile:a.files[0]})},n.readAsDataURL(a.files[0])}};case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){this.load().then((function(){})).catch((function(e){console.log({e:e}),window.alert("Error loading offer")}))}},{key:"uploadNewImage",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.uploading){e.next=2;break}return e.abrupt("return");case 2:return this.setState({uploading:!0}),e.prev=3,e.next=6,_.uploadImage(this.postId,this.state.newImageFile);case 6:this.setState({b64Image:null,newImageFile:null}),this.loadPost(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.log({e:e.t0}),window.alert("Error uploading image");case 14:this.setState({uploading:!1});case 15:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"closeOffer",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.closing){e.next=2;break}return e.abrupt("return");case 2:return this.setState({closing:!0}),e.prev=3,e.next=6,_.closeOffer(this.postId);case 6:return e.next=8,this.loadPost();case 8:window.alert("Offer has been closed successfully"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.log({e:e.t0}),window.alert("Error cancelling offer");case 15:this.setState({closing:!1});case 16:case"end":return e.stop()}}),e,this,[[3,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"removeImage",value:function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!window.confirm("Do you want to remove this image?")){e.next=7;break}return e.next=4,_.removeImage(this.postId,t);case 4:return e.next=6,this.loadPost();case 6:window.alert("Image successfully removed");case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),window.alert("Error removing the image");case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("form",{style:{padding:"2em"},onSubmit:this.submit},r.a.createElement("h3",null,"Oferta"),r.a.createElement("fieldset",{className:"uk-fieldset"},r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"T\xedtulo"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{disabled:!this.canSave,value:this.state.formValue.title,onChange:this.setValue,"custom-id":"title",className:"uk-input",type:"text",placeholder:"Title"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Descripci\xf3n de La Oferta"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("textarea",{disabled:!this.canSave,value:this.state.formValue.description,onChange:this.setValue,"custom-id":"description",className:"uk-textarea"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Moneda de Oferta"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{disabled:!this.canSave,value:this.state.formValue.offer_currency,className:"uk-select",id:"form-stacked-select",onChange:this.setValue,"custom-id":"offer_currency"},r.a.createElement("option",null,"Selecciona tu moneda"),r.a.createElement("option",{value:"USD"},"USD"),r.a.createElement("option",{value:"BSF"},"BSF")))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Cantidad en Oferta"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{disabled:!this.canSave,value:this.state.formValue.offer_ammount,onChange:this.setValue,"custom-id":"offer_ammount",type:"number",className:"uk-input"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Tipo de Pago"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{disabled:!this.canSave,value:this.state.formValue.offer_payment_method,onChange:this.setValue,"custom-id":"offer_payment_method",className:"uk-select",id:"form-stacked-select"},r.a.createElement("option",null,"Selecciona tu M\xe9todo de Pago"),r.a.createElement("option",{value:"transferencia"},"Transferencia"),r.a.createElement("option",{value:"efectivo"},"Efectivo")))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Acepta Moneda"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{disabled:!this.canSave,value:this.state.formValue.accept_currency,onChange:this.setValue,"custom-id":"accept_currency",className:"uk-select",id:"form-stacked-select"},r.a.createElement("option",null,"Seleccione la moneda a aceptar"),r.a.createElement("option",{value:"USD"},"USD"),r.a.createElement("option",{value:"BSF"},"BSF")))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Cantidad a Aceptar"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{disabled:!this.canSave,value:this.state.formValue.accept_ammount,onChange:this.setValue,"custom-id":"accept_ammount",type:"number",className:"uk-input"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Acepta M\xe9todo de Pago"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("select",{disabled:!this.canSave,value:this.state.formValue.accept_payment_method,onChange:this.setValue,"custom-id":"accept_payment_method",className:"uk-select",id:"form-stacked-select"},r.a.createElement("option",null,"Seleccione su M\xe9todo de Pago"),r.a.createElement("option",{value:"transferencia"},"Transferencia"),r.a.createElement("option",{value:"efectivo"},"Efectivo")))),r.a.createElement("div",{className:"uk-position-relative uk-visible-toggle uk-light","custom-tabindex":"-1","uk-slider":""},r.a.createElement("ul",{className:"uk-slider-items uk-child-width-1-2 uk-child-width-1-3@s uk-child-width-1-4@m"},r.a.createElement("input",{type:"file",hidden:!0,id:"newImageInput"}),this.canChooseImage?this.state.b64Image?r.a.createElement(r.a.Fragment,null,r.a.createElement("li",{style:{maxWidth:"400px",maxHeight:"300px",display:"inline-block"}},r.a.createElement("img",{"data-src":this.state.b64Image,alt:"Bill Image","uk-img":""}),r.a.createElement("button",{className:"uk-button",disabled:!this.canChooseImage,style:{backgroundColor:"#1e87f0",color:"white"},onClick:this.uploadNewImage},"Sube Nueva Im\xe1gen"))):r.a.createElement("li",{style:{maxWidth:"400px",maxHeight:"300px",display:"inline-block",textAlign:"center"}},r.a.createElement("button",{className:"uk-button",disabled:!this.canChooseImage,style:{backgroundColor:"#1e87f0",color:"white"},onClick:this.newImageInput},"Selecciona nueva Im\xe1gen")):r.a.createElement(r.a.Fragment,null),this.state.uploading?r.a.createElement("li",null,r.a.createElement("h3",{style:{color:"black"}},"Subiendo im\xe1gen...")):r.a.createElement(r.a.Fragment,null),this.state.formValue&&this.state.formValue.images?this.state.formValue.images.map((function(t){return r.a.createElement("li",{key:t.id},r.a.createElement("img",{src:t.downloadURL,style:{width:"300px",maxHeight:"500px"}}),e.canChooseImage?r.a.createElement("button",{className:"uk-button",disabled:!e.canChooseImage,style:{backgroundColor:"#1e87f0",color:"white"},onClick:function(){return e.removeImage(t)}},"Eliminar Im\xe1gen"):r.a.createElement(r.a.Fragment,null))})):r.a.createElement(r.a.Fragment,null)),r.a.createElement("a",{className:"uk-position-center-left uk-position-small uk-hidden-hover","uk-slidenav-previous":"","uk-slider-item":"previous"}),r.a.createElement("a",{className:"uk-position-center-right uk-position-small uk-hidden-hover","uk-slidenav-next":"","uk-slider-item":"next"})),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("legend",{className:"uk-legend",style:{fontSize:"1.2em"}},"Tasa de Cambio: ",r.a.createElement("b",null,this.exchangeRate))),this.canSave?r.a.createElement("button",{className:"uk-button uk-button-primary",role:"submit"},"Guardar Oferta"):this.state.hasBids?r.a.createElement("h3",null,"Esta oferta tiene pujas. No puede ser actualizada."):r.a.createElement(r.a.Fragment,null),this.state.formValue.status==C.ACTIVE?r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"uk-button uk-button-primary",onClick:this.closeOffer},"Cerrar Oferta")):r.a.createElement(r.a.Fragment,null,r.a.createElement("h3",null,"This offer has been ",r.a.createElement("b",null,_.getOfferStatus(this.state.formValue.status)))))))}},{key:"exchangeRate",get:function(){return(this.state.formValue.offer_ammount||1)/(this.state.formValue.accept_ammount||1)}},{key:"postId",get:function(){return this.props.match.params.postId}},{key:"canChooseImage",get:function(){return this.canSave&&!this.loading}},{key:"loading",get:function(){return this.state.uploading||this.state.closing||this.state.saving||this.state.loadingPost}},{key:"canSave",get:function(){return this.state.formValue.status===C.ACTIVE&&this.isOwn&&!this.loading&&!this.state.hasBids}},{key:"isOwn",get:function(){return w.auth.currentUser&&this.state.formValue.poster&&w.auth.currentUser.uid===this.state.formValue.poster}}]),a}(r.a.Component),Q=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={postData:{accept_ammount:1,accept_currency:"BSF",description:"1",offer_ammount:1,offer_currency:"USD",offer_payment_method:"Cash",title:"1",accept_payment_method:"Cash",poster:null,status:null,createdAt:null},hasBids:!1,bid:null,loading:{bid:!1,post:!1,bidAction:!1},ratedOffer:!1},n.loadPost=n.loadPost.bind(Object(I.a)(n)),n.state.postData={accept_ammount:1,accept_currency:"BSF",description:"1",offer_ammount:1,offer_currency:"USD",offer_payment_method:"Cash",title:"1",accept_payment_method:"Cash",poster:null,status:null,createdAt:null},n.placeBid=n.placeBid.bind(Object(I.a)(n)),n.cancelBid=n.cancelBid.bind(Object(I.a)(n)),n.setLoading=n.setLoading.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"loadPost",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,a,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading("post",!0),e.prev=1,e.t0=Promise,e.next=5,_.fetchOffer(this.postId);case 5:return e.t1=e.sent,e.next=8,Z.hasRateOnOffer(this.postId);case 8:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=12,e.t0.all.call(e.t0,e.t3);case 12:if(t=e.sent,a=t[0],n=t[1],a){e.next=17;break}throw new Error("Offer not found");case 17:this.setState((function(e){return e.postData=a,e.ratedOffer=n,e})),e.next=24;break;case 20:e.prev=20,e.t4=e.catch(1),console.log({e:e.t4}),window.alert("Error loading offer");case 24:this.setLoading("post",!1);case 25:case"end":return e.stop()}}),e,this,[[1,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadBid",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading("bid",!0),e.prev=1,e.next=4,W.getBids(this.postId);case 4:if((t=e.sent).size>0&&this.setState({bid:t.docs[0].data()}),!this.isOwn){e.next=11;break}return e.next=9,W.hasGeneralBids(this.postId);case 9:a=e.sent,this.setState({hasBids:a});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),console.log({err:e.t0});case 16:this.setLoading("bid",!1);case 17:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;this.postId&&this.loadPost().then((function(){e.loadBid()}))}},{key:"setLoading",value:function(e,t){this.setState((function(a){return a.loading[e]=t,a}))}},{key:"placeBid",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading("bidAction",!0),t={poster:null,status:null,offer:this.postId,createdAt:null},e.prev=2,e.next=5,W.createBid(t);case 5:return e.next=7,this.loadBid();case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0),window.alert("Error found creating bid.");case 13:this.setLoading("bidAction",!1);case 14:case"end":return e.stop()}}),e,this,[[2,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"cancelBid",value:function(){var e=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setLoading("bidAction",!0),e.prev=1,e.next=4,W.cancelBid(this.postId);case 4:return e.next=6,this.loadBid();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.log({e:e.t0}),window.alert("Cancelling bid");case 12:this.setLoading("bidAction",!1);case 13:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"rateOffer",value:function(){UIkit.modal(document.getElementById("rateSnippet")).show()}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h3",null,"Oferta. \xa0",null!==this.state.postData.status?r.a.createElement("b",null,_.getOfferStatus(this.state.postData.status||C.ACTIVE)):r.a.createElement(r.a.Fragment,null)),r.a.createElement("fieldset",{className:"uk-fieldset"},r.a.createElement("div",{className:"uk-margin"},r.a.createElement("h4",null,this.state.postData.title)),r.a.createElement("div",{className:"uk-margin"},this.state.postData.description),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("legend",{className:"uk-legend","custom-for":"form-stacked-select"},"Oferta: ",L.getCurrency(this.state.postData.offer_ammount)," ",this.state.postData.offer_currency)),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("legend",{className:"uk-legend","custom-for":"form-stacked-select"},"Paga via: ",this.state.postData.offer_payment_method)),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("legend",{className:"uk-legend","custom-for":"form-stacked-select"},"Acepta: ",L.getCurrency(this.state.postData.accept_ammount)," ",this.state.postData.accept_currency)),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("legend",{className:"uk-legend","custom-for":"form-stacked-select"},"Acepta Pago Via: ",this.state.postData.accept_payment_method)),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("legend",{className:"uk-legend",style:{fontSize:"1.2em"}},"Tasa de Cambio: ",r.a.createElement("b",null,this.exchangeRate))),this.isLoading||this.isOwn||this.state.bid?r.a.createElement(r.a.Fragment,null):r.a.createElement("button",{className:"uk-button uk-button-primary",onClick:this.placeBid},"Colocar Puja"),r.a.createElement("div",{className:"uk-position-relative uk-visible-toggle uk-light","uk-slider":""},r.a.createElement("ul",{className:"uk-slider-items uk-child-width-1-2 uk-child-width-1-3@s uk-child-width-1-4@m"},r.a.createElement("li",{style:{width:"0px"}}),this.state.postData&&this.state.postData.images?this.state.postData.images.map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement("img",{src:e.downloadURL,style:{width:"300px",maxHeight:"500px"}}))})):r.a.createElement(r.a.Fragment,null)),r.a.createElement("a",{className:"uk-position-center-left uk-position-small uk-hidden-hover","uk-slidenav-previous":"","uk-slider-item":"previous"}),r.a.createElement("a",{className:"uk-position-center-right uk-position-small uk-hidden-hover","uk-slidenav-next":"","uk-slider-item":"next"})),r.a.createElement("hr",null),!this.isOwn&&this.state.bid?r.a.createElement(r.a.Fragment,null,this.state.bid.status===A.ACTIVE?r.a.createElement("button",{className:"uk-button uk-button-primary",onClick:this.cancelBid},"Cancelar Puja"):this.state.ratedOffer?r.a.createElement(r.a.Fragment,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{id:"newRating",className:"uk-button uk-button-primary",onClick:this.rateOffer},"Calificar Oferta"))):r.a.createElement(r.a.Fragment,null),this.canEdit?r.a.createElement(h.b,{to:"/edit/post/".concat(this.postId)},r.a.createElement("button",{className:"uk-button uk-button-primary"},"Editar Oferta")):r.a.createElement(r.a.Fragment,null),r.a.createElement("hr",null),this.isOwn?r.a.createElement(Y,{match:this.props.match}):r.a.createElement(r.a.Fragment,null),r.a.createElement(q,{modalId:"rateSnippet",offerId:this.postId}),r.a.createElement(X,{match:this.props.match})))}},{key:"exchangeRate",get:function(){var e=this.state;return(e.postData.offer_ammount||1)/(e.postData.accept_ammount||1)}},{key:"postId",get:function(){return this.props.match.params.postId}},{key:"isOwn",get:function(){return w.auth.currentUser&&this.state.postData.poster&&w.auth.currentUser.uid===this.state.postData.poster}},{key:"canEdit",get:function(){return this.isOwn&&this.state.postData.status===C.ACTIVE&&!this.isLoading}},{key:"isLoading",get:function(){return this.state.loading.bid||this.state.loading.bidAction||this.state.loading.post}}]),a}(r.a.Component),ee=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,[{key:"updateContactInformation",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.hasValidContactUData(t)){e.next=2;break}throw new Error("Invalid data");case 2:if(w.auth.currentUser){e.next=4;break}throw new Error("User must be logged in");case 4:return e.next=6,w.firestore.collection("contact").doc(null===(a=w.auth.currentUser)||void 0===a?void 0:a.uid).set(t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getContactInformation",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.firestore.collection("contact").doc(null===(t=w.auth.currentUser)||void 0===t?void 0:t.uid).get();case 2:if(!(a=e.sent).exists){e.next=5;break}return e.abrupt("return",a.data()||{});case 5:return e.abrupt("return",{});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"Instance",get:function(){return this._instance=this._instance?this._instance:new e,this._instance}}]),e}();ee._instance=void 0;var te=ee.Instance,ae=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={formValue:{}},n.setValue=n.setValue.bind(Object(I.a)(n)),n.submit=n.submit.bind(Object(I.a)(n)),n.setLoading=n.setLoading.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"setLoading",value:function(e){this.setState({isLoading:e})}},{key:"setValue",value:function(e){var t=e.currentTarget.getAttribute("custom-id"),a=e.currentTarget.value;this.setState((function(e){return e.formValue[t]=a,e}))}},{key:"submit",value:function(e){var t=this;e.preventDefault(),console.log({form:this.state.formValue}),this.setLoading(!0),te.updateContactInformation(this.state.formValue).then((function(e){window.alert("Contacto almacenado"),t.setLoading(!1)})).catch((function(e){window.alert("Error actualizando tu contacto"),t.setLoading(!1)}))}},{key:"componentDidMount",value:function(){var e=this;this.setLoading(!0),w.listenAuthChanges((function(t){t&&te.getContactInformation().then((function(t){e.setState({formValue:t}),e.setLoading(!1)})).catch((function(t){window.alert("Error cargando la informaci\xf3n de contacto"),e.setLoading(!1)}))}))}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("form",{style:{padding:"2em"},onSubmit:this.submit},r.a.createElement("h3",null,"Informaci\xf3n de Contacto"),r.a.createElement("fieldset",{className:"uk-fieldset"},r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Tel\xe9fono de Contacto"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"phone",value:this.state.formValue.phone,type:"phone",className:"uk-input"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"N\xfamero de Contacto"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"whatsapp",value:this.state.formValue.whatsapp,type:"phone",className:"uk-input"}))),r.a.createElement("div",{className:"uk-margin"},r.a.createElement("label",{className:"uk-form-label","custom-for":"form-stacked-select"},"Email"),r.a.createElement("div",{className:"uk-form-controls"},r.a.createElement("input",{onChange:this.setValue,"custom-id":"email",value:this.state.formValue.email,type:"email",className:"uk-input"}))),r.a.createElement("button",{className:"uk-button uk-button-primary",disabled:this.state.isLoading,role:"submit"},"Guardar Informaci\xf3n de Contacto"))))}},{key:"exchangeRate",get:function(){return(this.state.formValue.offer_ammount||1)/(this.state.formValue.accept_ammount||1)}}]),a}(r.a.Component),ne=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={formValue:{},bidPaging:{startAfter:null,stopBefore:null,limit:5,page:0},ratePaging:{startAfter:null,stopBefore:null,limit:5,page:0}},n.setLoading=n.setLoading.bind(Object(I.a)(n)),n}return Object(o.a)(a,[{key:"setLoading",value:function(e){this.setState({isLoading:e})}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("h3",null,"User"),r.a.createElement("h4",null,"Bid Ratings"),r.a.createElement(X,{match:{params:{ratedUser:this.profileId,ratingType:"bid"}}}),r.a.createElement("h4",null,"Offer Ratings"),r.a.createElement(X,{match:{params:{ratedUser:this.profileId,ratingType:"offer"}}}))}},{key:"profileId",get:function(){return this.props.match.params.profileId}}]),a}(r.a.Component),re=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={currentUser:null},e}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=this;w.auth.onAuthStateChanged((function(t){e.setState((function(e){return e.currentUser=t,e}))}))}},{key:"render",value:function(){return r.a.createElement(h.a,null,r.a.createElement(M.a,null,r.a.createElement("link",{rel:"stylesheet",href:"https://cdn.jsdelivr.net/npm/uikit@3.5.4/dist/css/uikit.min.css"}),r.a.createElement("script",{src:"https://cdn.jsdelivr.net/npm/uikit@3.5.4/dist/js/uikit.min.js"}),r.a.createElement("script",{src:"https://cdn.jsdelivr.net/npm/uikit@3.5.4/dist/js/uikit-icons.min.js"})),r.a.createElement(O,null),r.a.createElement("hr",null),r.a.createElement("div",{id:"content"},r.a.createElement(x.b,{exact:!0,path:p.SIGN_UP,component:R}),r.a.createElement(x.b,{exact:!0,path:p.HOME,component:T}),r.a.createElement(x.b,{exact:!0,path:p.SIGN_IN,component:F}),r.a.createElement(x.b,{exact:!0,path:p.NEW_POST,component:U}),r.a.createElement(x.b,{path:p.VIEW_POST,component:Q}),r.a.createElement(x.b,{path:p.EDIT_POST,component:$}),r.a.createElement(x.b,{exact:!0,path:p.PROFILE,component:ae}),r.a.createElement(x.b,{path:p.PUBLIC_PROFILE,component:ne})))}}]),a}(r.a.Component);i.a.render(r.a.createElement(re,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.94609f12.chunk.js.map